- name: Crete harbor namespace
  k8s:
    state: present
    definition:
      apiVersion: v1
      kind: Namespace
      metadata:
        name: harbor
        labels:
          name: harbor

- name: Install Harbor with Helm
  community.kubernetes.helm:
    name: harbor
    chart_ref: harbor/harbor
    release_namespace: harbor
    values:
      expose:
        ingress:
          hosts:
            core: harbor.test.boredotter.dev
          annotations:
            kubernetes.io/ingress.class: "nginx"
            cert-manager.io/cluster-issuer: "letsencrypt-cluster-issuer"
            nginx.ingress.kubernetes.io/force-ssl-redirect: "true"
        tls:
          certSource: secret
          secret:
            secretName: harbor-tls
      externalURL: https://harbor.test.boredotter.dev